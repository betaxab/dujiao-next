package i18n

import (
	"fmt"
	"strings"

	"github.com/gin-gonic/gin"
)

const (
	LocaleZH = "zh-CN"
	LocaleTW = "zh-TW"
	LocaleEN = "en-US"
)

var messages = map[string]map[string]string{
	LocaleZH: {
		"error.jwt_secret_missing":                 "JWT secret 未配置",
		"error.auth_header_missing":                "缺少 Authorization header",
		"error.auth_header_invalid":                "Authorization header 格式错误",
		"error.token_invalid":                      "无效的 token",
		"error.token_revoked":                      "登录状态已失效，请重新登录",
		"error.bad_request":                        "请求参数错误",
		"error.email_invalid":                      "邮箱格式不正确",
		"error.verify_purpose_invalid":             "验证码用途无效",
		"error.email_exists":                       "邮箱已注册",
		"error.profile_empty":                      "请至少填写一项资料",
		"error.email_change_invalid":               "更换邮箱参数不合法",
		"error.email_change_exists":                "新邮箱已被注册",
		"error.user_not_found":                     "用户不存在",
		"error.verify_code_too_frequent":           "发送过于频繁，请稍后重试",
		"error.email_service_not_configured":       "邮箱服务未配置",
		"error.email_recipient_not_found":          "收件邮箱不存在，请检查后重试",
		"error.send_verify_code_failed":            "发送验证码失败",
		"error.verify_code_invalid":                "验证码错误",
		"error.verify_code_expired":                "验证码已过期",
		"error.verify_code_attempts_exceeded":      "验证码尝试次数过多",
		"error.password_weak":                      "密码强度不足",
		"error.password_min_length":                "密码长度至少 %d 位",
		"error.password_require_upper":             "需包含大写字母",
		"error.password_require_lower":             "需包含小写字母",
		"error.password_require_number":            "需包含数字",
		"error.password_require_special":           "需包含特殊字符",
		"error.register_failed":                    "注册失败",
		"error.agreement_required":                 "请先同意隐私政策和服务条款",
		"error.login_too_many":                     "登录尝试过多，请在 %d 秒后重试",
		"error.rate_limited":                       "请求过于频繁，请在 %d 秒后重试",
		"error.rate_limit_unavailable":             "限流服务不可用",
		"error.login_invalid":                      "邮箱或密码错误",
		"error.email_not_verified":                 "邮箱未验证",
		"error.user_disabled":                      "账号已禁用",
		"error.login_failed":                       "登录失败",
		"error.captcha_required":                   "请先完成验证码",
		"error.captcha_invalid":                    "验证码错误或已失效",
		"error.captcha_verify_failed":              "验证码校验失败",
		"error.captcha_config_invalid":             "验证码配置不合法",
		"error.captcha_unavailable":                "验证码服务不可用",
		"error.captcha_generate_failed":            "验证码生成失败",
		"error.user_update_failed":                 "更新用户资料失败",
		"error.reset_failed":                       "重置密码失败",
		"error.email_change_failed":                "更换邮箱失败",
		"error.unauthorized":                       "未授权",
		"error.user_id_invalid":                    "无效的用户ID",
		"error.user_id_type_invalid":               "系统错误: ID类型异常",
		"error.admin_id_invalid":                   "无效的管理员ID",
		"error.admin_id_type_invalid":              "系统错误: 管理员ID类型异常",
		"error.admin_username_invalid":             "管理员账号格式不合法",
		"error.admin_username_exists":              "管理员账号已存在",
		"error.admin_create_failed":                "创建管理员失败",
		"error.admin_update_failed":                "更新管理员失败",
		"error.admin_delete_failed":                "删除管理员失败",
		"error.admin_delete_self_forbidden":        "不允许删除当前登录管理员",
		"error.admin_delete_last_forbidden":        "至少保留一个管理员账号",
		"error.admin_delete_protected":             "默认超级管理员不允许删除",
		"error.product_price_invalid":              "商品价格或币种不合法",
		"error.product_purchase_invalid":           "商品购买身份不合法",
		"error.product_purchase_not_allowed":       "当前商品仅限会员购买",
		"error.user_fetch_failed":                  "获取用户信息失败",
		"error.user_login_log_fetch_failed":        "获取登录日志失败",
		"error.dashboard_fetch_failed":             "获取仪表盘数据失败",
		"error.config_fetch_failed":                "获取配置失败",
		"error.product_fetch_failed":               "获取商品失败",
		"error.product_not_found":                  "商品不存在",
		"error.post_fetch_failed":                  "获取文章失败",
		"error.post_not_found":                     "文章不存在",
		"error.banner_fetch_failed":                "获取 Banner 失败",
		"error.banner_not_found":                   "Banner 不存在",
		"error.banner_invalid":                     "Banner 参数不合法",
		"error.banner_create_failed":               "创建 Banner 失败",
		"error.banner_update_failed":               "更新 Banner 失败",
		"error.banner_delete_failed":               "删除 Banner 失败",
		"error.category_fetch_failed":              "获取分类失败",
		"error.category_not_found":                 "分类不存在",
		"error.admin_login_invalid":                "用户名或密码错误",
		"error.password_old_invalid":               "旧密码错误",
		"error.save_failed":                        "保存失败",
		"error.slug_exists":                        "Slug 已存在",
		"error.slug_used":                          "Slug 已被其他资源使用",
		"error.product_create_failed":              "创建商品失败",
		"error.product_update_failed":              "更新商品失败",
		"error.product_delete_failed":              "删除商品失败",
		"error.post_type_invalid":                  "文章类型不合法",
		"error.post_create_failed":                 "创建文章失败",
		"error.post_update_failed":                 "更新文章失败",
		"error.post_delete_failed":                 "删除文章失败",
		"error.category_create_failed":             "创建分类失败",
		"error.category_update_failed":             "更新分类失败",
		"error.category_delete_failed":             "删除分类失败",
		"error.category_in_use":                    "该分类下有商品，无法删除",
		"error.settings_fetch_failed":              "获取设置失败",
		"error.settings_save_failed":               "保存设置失败",
		"error.file_missing":                       "未上传文件",
		"error.upload_failed":                      "文件上传失败",
		"error.order_item_invalid":                 "订单项不合法",
		"error.order_amount_invalid":               "订单金额不合法",
		"error.order_currency_mismatch":            "订单币种不一致",
		"error.order_not_found":                    "订单不存在",
		"error.order_create_failed":                "创建订单失败",
		"error.order_fetch_failed":                 "获取订单失败",
		"error.order_status_invalid":               "订单状态不合法",
		"error.order_cancel_not_allowed":           "当前状态不允许取消订单",
		"error.order_update_failed":                "更新订单失败",
		"error.guest_email_required":               "游客邮箱不能为空",
		"error.guest_password_required":            "订单密码不能为空",
		"error.guest_order_not_found":              "未找到匹配的游客订单",
		"error.guest_coupon_not_allowed":           "游客订单暂不支持优惠券",
		"error.product_not_available":              "商品不可用或已下架",
		"error.coupon_invalid":                     "优惠券不合法",
		"error.coupon_not_found":                   "优惠券不存在",
		"error.coupon_inactive":                    "优惠券未启用",
		"error.coupon_not_started":                 "优惠券未开始",
		"error.coupon_expired":                     "优惠券已过期",
		"error.coupon_usage_limit":                 "优惠券已用完",
		"error.coupon_per_user_limit":              "已达到优惠券使用上限",
		"error.coupon_min_amount":                  "未满足优惠券使用门槛",
		"error.coupon_scope_invalid":               "优惠券不适用于该商品",
		"error.promotion_invalid":                  "活动价规则不合法",
		"error.coupon_create_failed":               "创建优惠券失败",
		"error.coupon_fetch_failed":                "获取优惠券失败",
		"error.coupon_update_failed":               "更新优惠券失败",
		"error.coupon_delete_failed":               "删除优惠券失败",
		"error.promotion_not_found":                "活动价不存在",
		"error.promotion_create_failed":            "创建活动价失败",
		"error.promotion_fetch_failed":             "获取活动价失败",
		"error.promotion_update_failed":            "更新活动价失败",
		"error.promotion_delete_failed":            "删除活动价失败",
		"error.fulfillment_invalid":                "交付信息不合法",
		"error.fulfillment_exists":                 "交付记录已存在",
		"error.fulfillment_create_failed":          "创建交付失败",
		"error.payment_invalid":                    "支付请求不合法",
		"error.payment_not_found":                  "支付记录不存在",
		"error.payment_create_failed":              "创建支付失败",
		"error.payment_update_failed":              "更新支付失败",
		"error.payment_status_invalid":             "支付状态不合法",
		"error.payment_amount_mismatch":            "支付金额不匹配",
		"error.payment_currency_mismatch":          "支付币种不匹配",
		"error.payment_channel_not_found":          "支付渠道不存在",
		"error.payment_channel_inactive":           "支付渠道已停用",
		"error.payment_provider_not_supported":     "支付渠道暂未支持",
		"error.payment_channel_config_invalid":     "支付渠道配置不完整",
		"error.payment_gateway_request_failed":     "支付网关请求失败",
		"error.payment_gateway_response_invalid":   "支付网关响应异常",
		"error.payment_fetch_failed":               "获取支付记录失败",
		"error.payment_export_failed":              "导出支付记录失败",
		"error.payment_callback_failed":            "支付回调处理失败",
		"error.payment_channel_invalid":            "支付渠道参数不合法",
		"error.payment_channel_create_failed":      "创建支付渠道失败",
		"error.payment_channel_update_failed":      "更新支付渠道失败",
		"error.payment_channel_delete_failed":      "删除支付渠道失败",
		"error.payment_channel_fetch_failed":       "获取支付渠道失败",
		"error.card_secret_invalid":                "卡密参数不合法",
		"error.card_secret_insufficient":           "卡密库存不足",
		"error.manual_stock_insufficient":          "人工库存不足",
		"error.manual_form_schema_invalid":         "人工交付表单配置不合法",
		"error.manual_form_required_missing":       "请填写完整的人工交付信息",
		"error.manual_form_field_invalid":          "人工交付表单字段值不合法",
		"error.manual_form_type_invalid":           "人工交付表单字段类型不正确",
		"error.manual_form_option_invalid":         "人工交付表单选项不合法",
		"error.manual_stock_invalid":               "人工库存参数不合法",
		"error.card_secret_create_failed":          "批量录入卡密失败",
		"error.card_secret_fetch_failed":           "获取卡密失败",
		"error.card_secret_batch_create_failed":    "创建卡密批次失败",
		"error.card_secret_batch_fetch_failed":     "获取卡密批次失败",
		"error.card_secret_import_failed":          "导入卡密失败",
		"error.card_secret_stats_failed":           "获取卡密统计失败",
		"error.card_secret_update_failed":          "更新卡密失败",
		"error.card_secret_not_found":              "卡密不存在",
		"error.queue_unavailable":                  "队列服务不可用，请稍后重试",
		"order.status.pending_payment":             "待支付",
		"order.status.paid":                        "已支付",
		"order.status.fulfilling":                  "处理中",
		"order.status.partially_delivered":         "部分交付",
		"order.status.delivered":                   "已交付",
		"order.status.completed":                   "已完成",
		"order.status.canceled":                    "已取消",
		"email.order_status.subject":               "订单状态更新：%s",
		"email.order_status.body":                  "订单号：%s\n状态：%s\n金额：%s %s\n\n感谢您的购买。",
		"email.order_status.body_paid":             "订单号：%s\n状态：%s\n金额：%s %s\n\n我们已收到您的付款，将尽快完成交付。",
		"email.order_status.body_canceled":         "订单号：%s\n状态：%s\n金额：%s %s\n\n订单已取消，如有疑问请联系管理员。",
		"email.order_status.body_delivered_simple": "订单号：%s\n状态：%s\n金额：%s %s\n\n交付已完成，感谢您的购买。",
		"email.order_status.body_delivered":        "订单号：%s\n状态：%s\n金额：%s %s\n\n交付内容：\n%s\n\n感谢您的购买。",
		"email.order_status.guest_tip":             "游客订单可使用下单邮箱与订单密码在网站查询订单详情。",
	},
	LocaleTW: {
		"error.jwt_secret_missing":                 "JWT secret 未配置",
		"error.auth_header_missing":                "缺少 Authorization header",
		"error.auth_header_invalid":                "Authorization header 格式錯誤",
		"error.token_invalid":                      "無效的 token",
		"error.token_revoked":                      "登入狀態已失效，請重新登入",
		"error.bad_request":                        "請求參數錯誤",
		"error.email_invalid":                      "郵箱格式不正確",
		"error.verify_purpose_invalid":             "驗證碼用途無效",
		"error.email_exists":                       "郵箱已註冊",
		"error.profile_empty":                      "請至少填寫一項資料",
		"error.email_change_invalid":               "更換郵箱參數不合法",
		"error.email_change_exists":                "新郵箱已被註冊",
		"error.user_not_found":                     "用戶不存在",
		"error.verify_code_too_frequent":           "發送過於頻繁，請稍後重試",
		"error.email_service_not_configured":       "郵箱服務未配置",
		"error.email_recipient_not_found":          "收件郵箱不存在，請檢查後重試",
		"error.send_verify_code_failed":            "發送驗證碼失敗",
		"error.verify_code_invalid":                "驗證碼錯誤",
		"error.verify_code_expired":                "驗證碼已過期",
		"error.verify_code_attempts_exceeded":      "驗證碼嘗試次數過多",
		"error.password_weak":                      "密碼強度不足",
		"error.password_min_length":                "密碼長度至少 %d 位",
		"error.password_require_upper":             "需包含大寫字母",
		"error.password_require_lower":             "需包含小寫字母",
		"error.password_require_number":            "需包含數字",
		"error.password_require_special":           "需包含特殊字符",
		"error.register_failed":                    "註冊失敗",
		"error.agreement_required":                 "請先同意隱私政策與服務條款",
		"error.login_too_many":                     "登入嘗試過多，請在 %d 秒後重試",
		"error.rate_limited":                       "請求過於頻繁，請在 %d 秒後重試",
		"error.rate_limit_unavailable":             "限流服務不可用",
		"error.login_invalid":                      "郵箱或密碼錯誤",
		"error.email_not_verified":                 "郵箱未驗證",
		"error.user_disabled":                      "帳號已禁用",
		"error.login_failed":                       "登入失敗",
		"error.captcha_required":                   "請先完成驗證碼",
		"error.captcha_invalid":                    "驗證碼錯誤或已失效",
		"error.captcha_verify_failed":              "驗證碼校驗失敗",
		"error.captcha_config_invalid":             "驗證碼配置不合法",
		"error.captcha_unavailable":                "驗證碼服務不可用",
		"error.captcha_generate_failed":            "驗證碼生成失敗",
		"error.user_update_failed":                 "更新用戶資料失敗",
		"error.reset_failed":                       "重置密碼失敗",
		"error.email_change_failed":                "更換郵箱失敗",
		"error.unauthorized":                       "未授權",
		"error.user_id_invalid":                    "無效的用戶ID",
		"error.user_id_type_invalid":               "系統錯誤: ID類型異常",
		"error.admin_id_invalid":                   "無效的管理員ID",
		"error.admin_id_type_invalid":              "系統錯誤: 管理員ID類型異常",
		"error.admin_username_invalid":             "管理員帳號格式不合法",
		"error.admin_username_exists":              "管理員帳號已存在",
		"error.admin_create_failed":                "建立管理員失敗",
		"error.admin_update_failed":                "更新管理員失敗",
		"error.admin_delete_failed":                "刪除管理員失敗",
		"error.admin_delete_self_forbidden":        "不允許刪除當前登入管理員",
		"error.admin_delete_last_forbidden":        "至少保留一個管理員帳號",
		"error.admin_delete_protected":             "預設超級管理員不允許刪除",
		"error.product_price_invalid":              "商品價格或幣種不合法",
		"error.product_purchase_invalid":           "商品購買身份不合法",
		"error.product_purchase_not_allowed":       "當前商品僅限會員購買",
		"error.user_fetch_failed":                  "獲取用戶信息失敗",
		"error.user_login_log_fetch_failed":        "獲取登入日誌失敗",
		"error.dashboard_fetch_failed":             "獲取儀表板數據失敗",
		"error.config_fetch_failed":                "獲取配置失敗",
		"error.product_fetch_failed":               "獲取商品失敗",
		"error.product_not_found":                  "商品不存在",
		"error.post_fetch_failed":                  "獲取文章失敗",
		"error.post_not_found":                     "文章不存在",
		"error.banner_fetch_failed":                "獲取 Banner 失敗",
		"error.banner_not_found":                   "Banner 不存在",
		"error.banner_invalid":                     "Banner 參數不合法",
		"error.banner_create_failed":               "建立 Banner 失敗",
		"error.banner_update_failed":               "更新 Banner 失敗",
		"error.banner_delete_failed":               "刪除 Banner 失敗",
		"error.category_fetch_failed":              "獲取分類失敗",
		"error.category_not_found":                 "分類不存在",
		"error.admin_login_invalid":                "用戶名或密碼錯誤",
		"error.password_old_invalid":               "舊密碼錯誤",
		"error.save_failed":                        "保存失敗",
		"error.slug_exists":                        "Slug 已存在",
		"error.slug_used":                          "Slug 已被其他資源使用",
		"error.product_create_failed":              "建立商品失敗",
		"error.product_update_failed":              "更新商品失敗",
		"error.product_delete_failed":              "刪除商品失敗",
		"error.post_type_invalid":                  "文章類型不合法",
		"error.post_create_failed":                 "建立文章失敗",
		"error.post_update_failed":                 "更新文章失敗",
		"error.post_delete_failed":                 "刪除文章失敗",
		"error.category_create_failed":             "建立分類失敗",
		"error.category_update_failed":             "更新分類失敗",
		"error.category_delete_failed":             "刪除分類失敗",
		"error.category_in_use":                    "該分類下有商品，無法刪除",
		"error.settings_fetch_failed":              "獲取設定失敗",
		"error.settings_save_failed":               "保存設定失敗",
		"error.file_missing":                       "未上傳文件",
		"error.upload_failed":                      "文件上傳失敗",
		"error.order_item_invalid":                 "訂單項不合法",
		"error.order_amount_invalid":               "訂單金額不合法",
		"error.order_currency_mismatch":            "訂單幣種不一致",
		"error.order_not_found":                    "訂單不存在",
		"error.order_create_failed":                "建立訂單失敗",
		"error.order_fetch_failed":                 "獲取訂單失敗",
		"error.order_status_invalid":               "訂單狀態不合法",
		"error.order_cancel_not_allowed":           "當前狀態不允許取消訂單",
		"error.order_update_failed":                "更新訂單失敗",
		"error.guest_email_required":               "遊客郵箱不能為空",
		"error.guest_password_required":            "訂單密碼不能為空",
		"error.guest_order_not_found":              "未找到匹配的遊客訂單",
		"error.guest_coupon_not_allowed":           "遊客訂單暫不支持優惠券",
		"error.product_not_available":              "商品不可用或已下架",
		"error.coupon_invalid":                     "優惠券不合法",
		"error.coupon_not_found":                   "優惠券不存在",
		"error.coupon_inactive":                    "優惠券未啟用",
		"error.coupon_not_started":                 "優惠券未開始",
		"error.coupon_expired":                     "優惠券已過期",
		"error.coupon_usage_limit":                 "優惠券已用完",
		"error.coupon_per_user_limit":              "已達到優惠券使用上限",
		"error.coupon_min_amount":                  "未滿足優惠券使用門檻",
		"error.coupon_scope_invalid":               "優惠券不適用於該商品",
		"error.promotion_invalid":                  "活動價規則不合法",
		"error.coupon_create_failed":               "建立優惠券失敗",
		"error.coupon_fetch_failed":                "獲取優惠券失敗",
		"error.coupon_update_failed":               "更新優惠券失敗",
		"error.coupon_delete_failed":               "刪除優惠券失敗",
		"error.promotion_not_found":                "活動價不存在",
		"error.promotion_create_failed":            "建立活動價失敗",
		"error.promotion_fetch_failed":             "獲取活動價失敗",
		"error.promotion_update_failed":            "更新活動價失敗",
		"error.promotion_delete_failed":            "刪除活動價失敗",
		"error.fulfillment_invalid":                "交付資訊不合法",
		"error.fulfillment_exists":                 "交付記錄已存在",
		"error.fulfillment_create_failed":          "建立交付失敗",
		"error.payment_invalid":                    "支付請求不合法",
		"error.payment_not_found":                  "支付記錄不存在",
		"error.payment_create_failed":              "建立支付失敗",
		"error.payment_update_failed":              "更新支付失敗",
		"error.payment_status_invalid":             "支付狀態不合法",
		"error.payment_amount_mismatch":            "支付金額不匹配",
		"error.payment_currency_mismatch":          "支付幣種不匹配",
		"error.payment_channel_not_found":          "支付渠道不存在",
		"error.payment_channel_inactive":           "支付渠道已停用",
		"error.payment_provider_not_supported":     "支付渠道暫未支援",
		"error.payment_channel_config_invalid":     "支付渠道設定不完整",
		"error.payment_gateway_request_failed":     "支付網關請求失敗",
		"error.payment_gateway_response_invalid":   "支付網關回應異常",
		"error.payment_fetch_failed":               "獲取支付記錄失敗",
		"error.payment_export_failed":              "導出支付記錄失敗",
		"error.payment_callback_failed":            "支付回調處理失敗",
		"error.payment_channel_invalid":            "支付渠道參數不合法",
		"error.payment_channel_create_failed":      "建立支付渠道失敗",
		"error.payment_channel_update_failed":      "更新支付渠道失敗",
		"error.payment_channel_delete_failed":      "刪除支付渠道失敗",
		"error.payment_channel_fetch_failed":       "獲取支付渠道失敗",
		"error.card_secret_invalid":                "卡密參數不合法",
		"error.card_secret_insufficient":           "卡密庫存不足",
		"error.manual_stock_insufficient":          "人工庫存不足",
		"error.manual_form_schema_invalid":         "人工交付表單配置不合法",
		"error.manual_form_required_missing":       "請填寫完整的人工交付資訊",
		"error.manual_form_field_invalid":          "人工交付表單欄位值不合法",
		"error.manual_form_type_invalid":           "人工交付表單欄位類型不正確",
		"error.manual_form_option_invalid":         "人工交付表單選項不合法",
		"error.manual_stock_invalid":               "人工庫存參數不合法",
		"error.card_secret_create_failed":          "批量錄入卡密失敗",
		"error.card_secret_fetch_failed":           "獲取卡密失敗",
		"error.card_secret_batch_create_failed":    "建立卡密批次失敗",
		"error.card_secret_batch_fetch_failed":     "獲取卡密批次失敗",
		"error.card_secret_import_failed":          "導入卡密失敗",
		"error.card_secret_stats_failed":           "獲取卡密統計失敗",
		"error.card_secret_update_failed":          "更新卡密失敗",
		"error.card_secret_not_found":              "卡密不存在",
		"error.queue_unavailable":                  "隊列服務不可用，請稍後重試",
		"order.status.pending_payment":             "待支付",
		"order.status.paid":                        "已支付",
		"order.status.fulfilling":                  "處理中",
		"order.status.partially_delivered":         "部分交付",
		"order.status.delivered":                   "已交付",
		"order.status.completed":                   "已完成",
		"order.status.canceled":                    "已取消",
		"email.order_status.subject":               "訂單狀態更新：%s",
		"email.order_status.body":                  "訂單號：%s\n狀態：%s\n金額：%s %s\n\n感謝您的購買。",
		"email.order_status.body_paid":             "訂單號：%s\n狀態：%s\n金額：%s %s\n\n已收到付款，將盡快完成交付。",
		"email.order_status.body_canceled":         "訂單號：%s\n狀態：%s\n金額：%s %s\n\n訂單已取消，如有疑問請聯絡管理員。",
		"email.order_status.body_delivered_simple": "訂單號：%s\n狀態：%s\n金額：%s %s\n\n交付已完成，感謝您的購買。",
		"email.order_status.body_delivered":        "訂單號：%s\n狀態：%s\n金額：%s %s\n\n交付內容：\n%s\n\n感謝您的購買。",
		"email.order_status.guest_tip":             "遊客訂單可使用下單信箱與訂單密碼在網站查詢訂單詳情。",
	},
	LocaleEN: {
		"error.jwt_secret_missing":                 "JWT secret is not configured",
		"error.auth_header_missing":                "Missing Authorization header",
		"error.auth_header_invalid":                "Invalid Authorization header format",
		"error.token_invalid":                      "Invalid token",
		"error.token_revoked":                      "Session expired, please sign in again",
		"error.bad_request":                        "Invalid request parameters",
		"error.email_invalid":                      "Invalid email format",
		"error.verify_purpose_invalid":             "Invalid verification purpose",
		"error.email_exists":                       "Email already registered",
		"error.profile_empty":                      "Please provide at least one profile field",
		"error.email_change_invalid":               "Invalid email change request",
		"error.email_change_exists":                "New email is already registered",
		"error.user_not_found":                     "User not found",
		"error.verify_code_too_frequent":           "Too many requests, please try again later",
		"error.email_service_not_configured":       "Email service is not configured",
		"error.email_recipient_not_found":          "Recipient email address does not exist",
		"error.send_verify_code_failed":            "Failed to send verification code",
		"error.verify_code_invalid":                "Invalid verification code",
		"error.verify_code_expired":                "Verification code expired",
		"error.verify_code_attempts_exceeded":      "Too many verification attempts",
		"error.password_weak":                      "Password is too weak",
		"error.password_min_length":                "Password must be at least %d characters",
		"error.password_require_upper":             "Password must include an uppercase letter",
		"error.password_require_lower":             "Password must include a lowercase letter",
		"error.password_require_number":            "Password must include a number",
		"error.password_require_special":           "Password must include a special character",
		"error.register_failed":                    "Registration failed",
		"error.agreement_required":                 "Please agree to the Privacy Policy and Terms of Service first",
		"error.login_too_many":                     "Too many login attempts, retry in %d seconds",
		"error.rate_limited":                       "Too many requests, retry in %d seconds",
		"error.rate_limit_unavailable":             "Rate limit service unavailable",
		"error.login_invalid":                      "Invalid email or password",
		"error.email_not_verified":                 "Email not verified",
		"error.user_disabled":                      "Account disabled",
		"error.login_failed":                       "Login failed",
		"error.captcha_required":                   "Please complete captcha verification",
		"error.captcha_invalid":                    "Captcha is invalid or expired",
		"error.captcha_verify_failed":              "Failed to verify captcha",
		"error.captcha_config_invalid":             "Captcha configuration is invalid",
		"error.captcha_unavailable":                "Captcha service is unavailable",
		"error.captcha_generate_failed":            "Failed to generate captcha",
		"error.user_update_failed":                 "Failed to update user profile",
		"error.reset_failed":                       "Password reset failed",
		"error.email_change_failed":                "Failed to change email",
		"error.unauthorized":                       "Unauthorized",
		"error.user_id_invalid":                    "Invalid user ID",
		"error.user_id_type_invalid":               "System error: invalid ID type",
		"error.admin_id_invalid":                   "Invalid admin ID",
		"error.admin_id_type_invalid":              "System error: invalid admin ID type",
		"error.admin_username_invalid":             "Invalid admin username format",
		"error.admin_username_exists":              "Admin username already exists",
		"error.admin_create_failed":                "Failed to create admin",
		"error.admin_update_failed":                "Failed to update admin",
		"error.admin_delete_failed":                "Failed to delete admin",
		"error.admin_delete_self_forbidden":        "Cannot delete current logged-in admin",
		"error.admin_delete_last_forbidden":        "At least one admin must be kept",
		"error.admin_delete_protected":             "Default super admin cannot be deleted",
		"error.product_price_invalid":              "Invalid product price or currency",
		"error.product_purchase_invalid":           "Invalid product purchase type",
		"error.product_purchase_not_allowed":       "This product requires member purchase",
		"error.user_fetch_failed":                  "Failed to fetch user",
		"error.user_login_log_fetch_failed":        "Failed to fetch login logs",
		"error.dashboard_fetch_failed":             "Failed to fetch dashboard data",
		"error.config_fetch_failed":                "Failed to fetch configuration",
		"error.product_fetch_failed":               "Failed to fetch products",
		"error.product_not_found":                  "Product not found",
		"error.post_fetch_failed":                  "Failed to fetch posts",
		"error.post_not_found":                     "Post not found",
		"error.banner_fetch_failed":                "Failed to fetch banners",
		"error.banner_not_found":                   "Banner not found",
		"error.banner_invalid":                     "Invalid banner payload",
		"error.banner_create_failed":               "Failed to create banner",
		"error.banner_update_failed":               "Failed to update banner",
		"error.banner_delete_failed":               "Failed to delete banner",
		"error.category_fetch_failed":              "Failed to fetch categories",
		"error.category_not_found":                 "Category not found",
		"error.admin_login_invalid":                "Invalid username or password",
		"error.password_old_invalid":               "Incorrect old password",
		"error.save_failed":                        "Save failed",
		"error.slug_exists":                        "Slug already exists",
		"error.slug_used":                          "Slug is already used by another resource",
		"error.product_create_failed":              "Failed to create product",
		"error.product_update_failed":              "Failed to update product",
		"error.product_delete_failed":              "Failed to delete product",
		"error.post_type_invalid":                  "Invalid post type",
		"error.post_create_failed":                 "Failed to create post",
		"error.post_update_failed":                 "Failed to update post",
		"error.post_delete_failed":                 "Failed to delete post",
		"error.category_create_failed":             "Failed to create category",
		"error.category_update_failed":             "Failed to update category",
		"error.category_delete_failed":             "Failed to delete category",
		"error.category_in_use":                    "Category has products and cannot be deleted",
		"error.settings_fetch_failed":              "Failed to fetch settings",
		"error.settings_save_failed":               "Failed to save settings",
		"error.file_missing":                       "No file uploaded",
		"error.upload_failed":                      "File upload failed",
		"error.order_item_invalid":                 "Invalid order item",
		"error.order_amount_invalid":               "Invalid order amount",
		"error.order_currency_mismatch":            "Order currency mismatch",
		"error.order_not_found":                    "Order not found",
		"error.order_create_failed":                "Failed to create order",
		"error.order_fetch_failed":                 "Failed to fetch order",
		"error.order_status_invalid":               "Invalid order status",
		"error.order_cancel_not_allowed":           "Order cannot be canceled in current status",
		"error.order_update_failed":                "Failed to update order",
		"error.guest_email_required":               "Guest email is required",
		"error.guest_password_required":            "Order password is required",
		"error.guest_order_not_found":              "Guest order not found",
		"error.guest_coupon_not_allowed":           "Guest orders do not support coupons yet",
		"error.product_not_available":              "Product is not available",
		"error.coupon_invalid":                     "Invalid coupon",
		"error.coupon_not_found":                   "Coupon not found",
		"error.coupon_inactive":                    "Coupon is inactive",
		"error.coupon_not_started":                 "Coupon is not started",
		"error.coupon_expired":                     "Coupon expired",
		"error.coupon_usage_limit":                 "Coupon usage limit reached",
		"error.coupon_per_user_limit":              "Coupon usage limit per user reached",
		"error.coupon_min_amount":                  "Coupon minimum amount not met",
		"error.coupon_scope_invalid":               "Coupon is not applicable to this product",
		"error.promotion_invalid":                  "Invalid promotion rule",
		"error.coupon_create_failed":               "Failed to create coupon",
		"error.coupon_fetch_failed":                "Failed to fetch coupons",
		"error.coupon_update_failed":               "Failed to update coupon",
		"error.coupon_delete_failed":               "Failed to delete coupon",
		"error.promotion_not_found":                "Promotion not found",
		"error.promotion_create_failed":            "Failed to create promotion",
		"error.promotion_fetch_failed":             "Failed to fetch promotions",
		"error.promotion_update_failed":            "Failed to update promotion",
		"error.promotion_delete_failed":            "Failed to delete promotion",
		"error.fulfillment_invalid":                "Invalid fulfillment data",
		"error.fulfillment_exists":                 "Fulfillment already exists",
		"error.fulfillment_create_failed":          "Failed to create fulfillment",
		"error.payment_invalid":                    "Invalid payment request",
		"error.payment_not_found":                  "Payment not found",
		"error.payment_create_failed":              "Failed to create payment",
		"error.payment_update_failed":              "Failed to update payment",
		"error.payment_status_invalid":             "Invalid payment status",
		"error.payment_amount_mismatch":            "Payment amount mismatch",
		"error.payment_currency_mismatch":          "Payment currency mismatch",
		"error.payment_channel_not_found":          "Payment channel not found",
		"error.payment_channel_inactive":           "Payment channel is inactive",
		"error.payment_provider_not_supported":     "Payment provider is not supported",
		"error.payment_channel_config_invalid":     "Payment channel config is invalid",
		"error.payment_gateway_request_failed":     "Payment gateway request failed",
		"error.payment_gateway_response_invalid":   "Payment gateway response invalid",
		"error.payment_fetch_failed":               "Failed to fetch payments",
		"error.payment_export_failed":              "Failed to export payments",
		"error.payment_callback_failed":            "Failed to handle payment callback",
		"error.payment_channel_invalid":            "Invalid payment channel parameters",
		"error.payment_channel_create_failed":      "Failed to create payment channel",
		"error.payment_channel_update_failed":      "Failed to update payment channel",
		"error.payment_channel_delete_failed":      "Failed to delete payment channel",
		"error.payment_channel_fetch_failed":       "Failed to fetch payment channels",
		"error.card_secret_invalid":                "Invalid card secret data",
		"error.card_secret_insufficient":           "Insufficient card secret inventory",
		"error.manual_stock_insufficient":          "Insufficient manual inventory",
		"error.manual_form_schema_invalid":         "Manual fulfillment form schema is invalid",
		"error.manual_form_required_missing":       "Please complete required manual fulfillment fields",
		"error.manual_form_field_invalid":          "Manual fulfillment field value is invalid",
		"error.manual_form_type_invalid":           "Manual fulfillment field type is invalid",
		"error.manual_form_option_invalid":         "Manual fulfillment field option is invalid",
		"error.manual_stock_invalid":               "Invalid manual inventory value",
		"error.card_secret_create_failed":          "Failed to import card secrets",
		"error.card_secret_fetch_failed":           "Failed to fetch card secrets",
		"error.card_secret_batch_create_failed":    "Failed to create card secret batch",
		"error.card_secret_batch_fetch_failed":     "Failed to fetch card secret batches",
		"error.card_secret_import_failed":          "Failed to import card secrets",
		"error.card_secret_stats_failed":           "Failed to fetch card secret stats",
		"error.card_secret_update_failed":          "Failed to update card secret",
		"error.card_secret_not_found":              "Card secret not found",
		"error.queue_unavailable":                  "Queue service unavailable, please try again later",
		"order.status.pending_payment":             "Pending Payment",
		"order.status.paid":                        "Paid",
		"order.status.fulfilling":                  "Processing",
		"order.status.partially_delivered":         "Partially delivered",
		"order.status.delivered":                   "Delivered",
		"order.status.completed":                   "Completed",
		"order.status.canceled":                    "Canceled",
		"email.order_status.subject":               "Order status updated: %s",
		"email.order_status.body":                  "Order No: %s\nStatus: %s\nAmount: %s %s\n\nThank you for your purchase.",
		"email.order_status.body_paid":             "Order No: %s\nStatus: %s\nAmount: %s %s\n\nWe have received your payment and will deliver soon.",
		"email.order_status.body_canceled":         "Order No: %s\nStatus: %s\nAmount: %s %s\n\nThe order has been canceled. Please contact admin if needed.",
		"email.order_status.body_delivered_simple": "Order No: %s\nStatus: %s\nAmount: %s %s\n\nDelivery completed. Thank you for your purchase.",
		"email.order_status.body_delivered":        "Order No: %s\nStatus: %s\nAmount: %s %s\n\nDelivery content:\n%s\n\nThank you for your purchase.",
		"email.order_status.guest_tip":             "Guest orders can be queried on the site using the checkout email and order password.",
	},
}

// ResolveLocale 根据请求解析语言
func ResolveLocale(c *gin.Context) string {
	if c == nil {
		return LocaleZH
	}
	if lang := strings.TrimSpace(c.Query("lang")); lang != "" {
		return normalizeLocale(lang)
	}
	if lang := strings.TrimSpace(c.GetHeader("X-Lang")); lang != "" {
		return normalizeLocale(lang)
	}
	accept := strings.TrimSpace(c.GetHeader("Accept-Language"))
	if accept == "" {
		return LocaleZH
	}
	parts := strings.Split(accept, ",")
	if len(parts) == 0 {
		return LocaleZH
	}
	return normalizeLocale(parts[0])
}

// T 获取翻译文本
func T(locale, key string) string {
	if locale == "" {
		locale = LocaleZH
	}
	if bundle, ok := messages[locale]; ok {
		if msg, ok := bundle[key]; ok {
			return msg
		}
	}
	if bundle, ok := messages[LocaleZH]; ok {
		if msg, ok := bundle[key]; ok {
			return msg
		}
	}
	return key
}

// Sprintf 获取带参数的翻译文本
func Sprintf(locale, key string, args ...interface{}) string {
	return fmt.Sprintf(T(locale, key), args...)
}

func normalizeLocale(locale string) string {
	l := strings.ToLower(strings.TrimSpace(locale))
	switch {
	case strings.HasPrefix(l, "zh-tw"), strings.HasPrefix(l, "zh-hk"), strings.HasPrefix(l, "zh-mo"):
		return LocaleTW
	case strings.HasPrefix(l, "zh"):
		return LocaleZH
	case strings.HasPrefix(l, "en"):
		return LocaleEN
	default:
		return LocaleZH
	}
}
